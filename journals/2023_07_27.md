- # 暗号技術入門
- ## 第9章 デジタル署名
- ### デジタル署名(電子署名)
- メッセージ認証コードは第三者に対する認証と否認防止には役立たない
	- 送信者と受信者が同じ鍵を共有しているため、受信者も正しいMAC値を計算することが出来る → 送信者が送ったメッセージであると第三者が判断出来ない
- デジタル署名は、改竄の検出、なりすましの検出(認証)、否認防止を行う技術
	- メッセージの署名を作成するという行為とメッセージの署名を検証するという行為がある
	- 署名を作成するのは送信者
		- 署名用の鍵を使う
		- 署名用の鍵を持っているのは署名をする人だけ
	- 署名を検証するのは受信者(第三者が行う場合もある)
		- 検証用の鍵を使う
		- 検証用の鍵は署名を検証する人なら誰でも持つことが出来る
	- 公開鍵暗号では、公開鍵で暗号化、秘密鍵で復号化をしたけど、その逆(秘密鍵で暗号化、公開鍵で復号化)をすれば良い
		- 秘密鍵で暗号化した暗号文は、秘密鍵と対になっている公開鍵でしか復号化出来ない
- ### デジタル署名の方法
	- メッセージに直接署名する方法
		- 送信者は、送信者の秘密鍵でメッセージを暗号化して署名を作る
		- 受信者は、送信者の公開鍵で署名を復号化し、受信したメッセージと比較する
		- 一致すれば署名の検証に成功、一致しなければ失敗
		- メッセージ全体を公開鍵暗号で暗号化するため時間がかかる
	- メッセージのハッシュ値に署名する方法
		- ハッシュ値は短いので公開鍵暗号で暗号化するのにかかる時間は短い
		- 送信者は一方向ハッシュ関数でメッセージのハッシュ値を計算し、送信者の秘密鍵でハッシュ値を暗号化する
		- 受信者は、送信者の公開鍵で署名を復号化し、受信したメッセージのハッシュ値(一方向ハッシュ関数で計算)と比較する
		- 一致すれば署名の検証に成功、一致しなければ失敗
	- 上に書いた2つの手順ではメッセージの機密性が守られていない
		- デジタル署名は機密性を守るためのものではない
		- 暗号化と署名を組み合わせる方法 → 第13章 PGP
- ### デジタル署名の利用例
	- セキュリティ情報のアナウンス(JPCERT/CCとか)
		- 悪意のある人のなりすましは防ぎたいので、デジタル署名を使う
			- メッセージ認証コードだと、閲覧する人全員と鍵を共有しないといけない
		- メッセージを暗号化する必要はない
			- メッセージが暗号化されない署名のことをクリア署名と呼ぶ
	- ソフトウェアのダウンロード
		- ソフトウェアの作成者がソフトウェアにデジタル署名を施す
		- Androidではデジタル署名がないアプリケーションをインストールすることは出来ない
	- 公開鍵の証明書
		- 入手した公開鍵が正しい公開鍵であるかを検証するために、公開鍵をメッセージとみなし、デジタル署名を施す
		- 公開鍵にデジタル署名をつけたものを公開鍵の証明書という
	- SSL/TLS
		- サーバが正しいものであることを認証するためにサーバ証明書を用いる
			- サーバ証明書とはサーバの公開鍵にデジタル署名を施したもの
		- 逆にクライアントを認証してもらうためにクライアント証明書を用いることもある
- ### デジタル署名に対する攻撃
	- 中間者攻撃
		- 公開鍵の認証が必要
	- 一方向ハッシュ関数に対する攻撃
	- デジタル署名を使って、公開鍵暗号の復号化を行う
		- RSA暗号を用いる場合を考える
		- AliceがBobに、Bobの公開鍵を使って暗号化したメッセージ(メッセージ ^ E mod N)を送信したとする
		- Malloryはこの暗号文を盗聴し、保存する
		- Malloryは保存した暗号文にデジタル署名して返信してもらうようBobにお願いする
			- ランダムなデータであるから安全と言ってデジタル署名をしてもらう
		- Bobはデジタル署名する
		- デジタル署名した結果は暗号文を復号化したもの(暗号文 ^ D mod N)になっている
		- 対策
			- メッセージに直接署名するのではなく、ハッシュ値に署名する方が安全
			- 公開鍵暗号で使う鍵ペアとデジタル署名で使う鍵ペアを分ける
			- 最も大事なのは、意味が分からないメッセージにデジタル署名をしないこと
				- 意味が分からない内容の契約書に捺印をするようなもの
	- 潜在的偽造
		- 署名対象となるのが意味のないメッセージであったとしても、正しいデジタル署名が作れてしまうことをデジタル署名の潜在的偽造という
		- RSAの場合は、潜在的偽造が可能
			- ランダムなビット列Sについて、RSAの公開鍵で暗号化したものをMとすると、Mのデジタル署名がSになるため(S = M ^ D mod N)
				- ~~mod N で M = S ^ E → 両辺をD乗して、mod N で M ^ D = S ^ E ^ D → RSAにおけるEとDの条件より、S = S ^ E ^ D mod N → S = M ^ D mod N~~ 嘘証明
			- Sをデジタル署名として付与することで、公開鍵を持つ人がメッセージMを送ったことにすることが出来る
				- このことからも公開鍵暗号で使う鍵ペアとデジタル署名で使う鍵ペアを分けることが大事
- ### デジタル署名でも解決できない問題
	- 署名の検証を行う時に用いる公開鍵が、本物の送信者のものか分からない
		- 結局なりすましは解決出来てない...
		- 正しい公開鍵を入手するために考えられたのが証明書
			- 公開鍵をメッセージとみなし、信頼出来る別の人にデジタル署名してもらったもの
			- これを検証するためにも公開鍵が必要になって堂々巡りになる → 公開鍵基盤(PKI)