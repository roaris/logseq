# 徳丸本
- ## 4章 Webアプリケーションの機能別に見るセキュリティバグ(続き)
- ### 4.16 Web API実装における脆弱性(続き)
- #### 4.16.8 CORSの検証不備
	- 検証不備の例
		- Access-Control-Allow-Originを`*`にする
			- XHRのwithCredentialsがtrueである場合は、Access-Control-Allow-Originを`*`にすることは出来ず、オリジンを指定しないといけない([参考](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS/Errors/CORSNotSupportingCredentials))
		- 意図的な緩和
			- 例: https://stackoverflow.com/questions/8719276/
				- Access-Control-Allow-Originを`*`にしない代わりに、Originヘッダの値をそのまま設定している
- #### 4.16.9 セキュリティを強化するレスポンスヘッダ
	- X-Frame-Options
		- クリックジャッキングの防止
	- X-Content-Type-Options
		- ファイルタイプをブラウザに誤認させるタイプの攻撃の防止
	- X-XSS-Protection
		- 反射型XSSをブラウザが検知し、無効化する機能だが、返って脆弱性につながるケースがあるため、現在は非推奨
	- Content-Security-Policy
	  id:: 64fb4894-7ce5-4e6c-baa9-1b99f2538e13
		- Content-Security-Policyヘッダは主にXSSを緩和するためのヘッダ
		- `Content-Security-Policy: default-src 'self'`とすると、スクリプト、画像、CSSといった全てのメディアをサイト自身のオリジンからのみ読み込む
			- HTMLページ内に記述するJavaScript(インラインスクリプト)も禁止し、これによってXSSを防ぐ
		- `Content-Security-Policy: default-src 'self' example.com *.example.com`とすると、自身のオリジンに加えて、example.comとexample.comの全てのサブドメインから読み込む
		- [参考1](https://developer.mozilla.org/ja/docs/Web/HTTP/CSP), [参考2](https://it-infra.techmatrix.jp/blog/check20)
	- Strict-Transport-Security
		- HTTP Strict Transport Security(HSTS)という仕様があり、これはブラウザに強制的にHTTPSでアクセスさせるためのもの
		- `Strict-Transport-Security: max-age=31536000`とすると、ブラウザは当該ドメインへの接続を365日間HTTPSでしか行わない
		- `Strict-Transport-Security: max-age=31536000; includeSubDomains`とするとサブドメインへの接続も含める
		- 指定された期間はHTTPでアクセス出来なくなってしまう(HTTPSでの通信に何か問題があった時に困る 証明書の有効期限が切れて、一時的にHTTPでアクセスさせたい時とか？)
			- HSTSの設定の削除はchrome://net-internals/\#hstsから出来る([参考](https://laboradian.com/disable-hsts-for-domain/))