# NW過去問
- ## [令和3年 午後I](https://www.ipa.go.jp/shiken/mondai-kaiotu/gmcbt8000000d5ru-att/2021r03h_nw_pm1_qs.pdf)
- ### 問2
	- 設問1
		- a : 共通鍵
			- 解答例 : 共有鍵
			- 共通鍵でも良いよね？
		- b : 分からない
			- 解答例 : ルータ
		- c : 分からない
			- 解答例 : コスト
		- d : ダイクストラ
		- e : 172.16.0.0
	- 設問2 : 分からない
		- 解答例 : OSPFへデフォルトルートを導入する
		- OSPFにはデフォルトルートを配布する機能があるらしい([参考](https://www.infraexpert.com/study/ospfz24.html))
		- https://thinkit.co.jp/article/18955
			- 「本社のルータや各支店のL3SWのデフォルトルートをFWにする」とあるが、ネクストホップ以外をルーティングテーブルに登録することは出来ないのではと思った
	- 設問3
		- (1) 経路テーブルのサイズを小さくするため
			- [OSPFにおける経路集約](https://www.infraexpert.com/study/ospfz23.html)
		- (2) ルータ
		- (3) L3SW4, L3SW5
			- 解答例 : ルータとFWの間
			- https://thinkit.co.jp/article/18955
				- 支社のL3SWのデフォルトルートに本社のルータ、本社のルータのデフォルトルートにFWが設定されていると考える
					- 広域イーサ網は巨大なL2の範囲と考えておく
				- 例えば、支社1のPCが172.16.1.1宛ての通信を送信した時、ルータはデフォルトルートであるFWに送信する
				- FWにはルータからのLSAで、経路集約された形で172.16.0.0/16宛ての通信はルータに飛ばすように登録されているので、ルータに再度通信が戻ってしまう
		- (4)
			- f : 分からない
				- 解答例 : ルータ
			- g : 分からない
				- 解答例 : 172.16.0.0/16
				- 本社のPCから支社のPCへは通信出来る
					- 複数のネクストホップが存在する時、ネットワークアドレスのビット長が最も長いネクストホップが使われるため([参考](https://www.infraexpert.com/study/routing.html))
					- ロンゲストマッチという
	- 設問4
		- (1) 分からない
			- 解答例 : h, i, j, k, l
		- (2)
			- 機器 : L3SW1, L3SW6
				- 解答例 : ルータ、L3SW1
			- 設定内容 : 分からない
				- 解答例 : OSPF仮想リンクの接続設定を行う
		- (3)
			- 機器 : ルータ
				- 解答例 : L3SW1
			- 設定内容 : 分からない
				- 解答例 : OSPFエリア1の支社個別経路を172.16.0.0/16に集約する
				- https://thinkit.co.jp/article/18955
					- L3SW1では経路集約が行われていないが、L3SW1とルータがOSPF仮想リンクで繋がっているので、L3SW1で受け取った経路情報がルータに届けられ、ロンゲストマッチにより、ルータの経路集約が使われなくなる
	- メモ
		- IPSec
			- IPパケットの暗号化、認証の機能を提供するプロトコル
			- トランスポートモードとトンネルモードという2つのモードが存在する
				- トランスポートモードでは、IPヘッダとIPペイロードの間にAHヘッダ or ESPヘッダが追加される
				- トンネルモードでは、IPヘッダの前に新IPヘッダが追加され、新IPヘッダと旧IPヘッダの間にAHヘッダ or ESPヘッダが追加される
					- 新IPヘッダの中身は不明
			- IPSecの中にAHとESPという2つのセキュリティプロトコルが存在する
				- AH(Authentiction Header)
					- 認証を行うプロトコル
					- AHヘッダの中にAuthentication Dataというフィールドがあり、HMAC値が示されている
						- 何を対象にHMAC値を計算しているのかというと、[これ](https://www.infraexpert.com/study/ipsec6.html)によると、
							- トランスポートモードでは、IPヘッダ、AHヘッダ、IPペイロード
							- トンネルモードでは、新IPヘッダ、AHヘッダ、旧IPヘッダ、IPペイロード
						- AHヘッダの中にHMAC値があるんだから、AHヘッダがHMAC値の計算に含まれるというのは謎である
				- ESP(Encapsulated Security Payload)
					- 認証に加えて、暗号化も行うプロトコル
					- ESPヘッダの中にAuthentication Dataというフィールドがあり、HMAC値が示されている
						- 何を対象にHMAC値を計算しているのかというと、[これ](https://www.infraexpert.com/study/ipsec6.html)によると、
							- トランスポートモードでは、ESPヘッダ、IPペイロード、ESPトレーラ
							- トンネルモードでは、ESPヘッダ、旧IPヘッダ、IPペイロード、ESPトレーラ
						- これまた、ESPヘッダの中にHMAC値があるんだから、ESPヘッダがHMAC値の計算に含まれるというのは謎である
					- どの部分が暗号化されるのかというと、[これ](https://www.infraexpert.com/study/ipsec6.html)によると、
						- トランスポートモードでは、IPペイロード、ESPトレーラ
						- トンネルモードでは、旧IPヘッダ、IPペイロード、ESPトレーラ
					- ESPヘッダだけではなく、ESPトレーラとESP認証データというのが末尾に追加されるが、何を目的としたデータなのか不明
			- HMACに使う鍵や暗号化に使う鍵をIKE(Internet Key Exchange)というプロトコルで事前に共有しておく
			- SSL/TLSとの違い([参考](https://milestone-of-se.nesuke.com/nw-basic/tls/compare-with-ipsec-and-tls/))
				- IPSecはネットワーク層のプロトコル
				- SSL/TLSはトランスポート層のプロトコル
				- ESPで暗号化される範囲にIPペイロードが含まれているので、IPペイロードの中のTCPヘッダ / UDPヘッダも暗号化されることになる
				- TCPヘッダ / UDPヘッダが暗号化されているとFWのアクセス制御が柔軟に行えないという欠点があるとのこと
		- OSPF(Open Shortest Path Protocol)([参考](https://www.infraexpert.com/study/ospfz2.html))
		  id:: 660d7c07-9e35-42e2-945f-eff27ca50eba
			- ダイナミックルーティングプロトコルの一種
			- 簡単に言うと、ルータ同士が情報を交換し合って、各ルータがネットワーク構成(グラフ)を把握し、ダイクストラ法を使って、ルーティングテーブルを生成する
			- LSA(Link State Advertisement)と呼ばれる情報を送信し合う
				- LSAはLSDB(Link State Database)に保存される
				- LSAには何個か種類がある(ルータLSA、ネットワークLSAなど)
				- 指名ルータ(DR : Desinated Router)というのが存在していて、全てのルータ間でLSAを交換するのではなく、指名ルータを介してLSAを交換する
			- 各ルータはLSDB内のLSAを組み合わせてネットワーク構成を把握する
			- ダイクストラ法における辺の重みは100Mbps / 帯域幅(bps)で計算される
				- 10Mbpsの場合は10、100Mbpsの場合は1、1Gbpsの場合は計算上は0.1だけど1として扱うらしい
			- コスト最小の経路が複数存在する場合は分散される
			- エリア([参考](https://www.infraexpert.com/study/ospfz4.html))
				- エリアに分割し、異なるエリアについての情報は経路集約された情報のみ保持する
				- 同じエリア内の全てのルータは同じLSDBを保持する
				- エリアに分割することで以下のメリットがある
					- LSDBのサイズが小さくなる
					- ネットワーク構成変更時に再計算する頻度が減る(異なるエリアの変更は無視するため)
					- ルーティングテーブルのサイズが縮小する
				- ルータのインタフェース毎に参加するエリアを指定する
				- 異なるエリア同士を接続するルータをエリア境界ルーター(AR : Area Border Router)と呼ぶ
					- ABRは異なるエリアのルータを経路集約して内部ルータに通知する
				- 異なるAS同士を接続するルータをAS境界ルータ(ASBR : AS Boundary Router)と呼ぶ
					- AS(Autonomous System)とは、共通のプロトコルで経路情報をやり取りする範囲のこと
					- 例えば、OSPFを使う範囲とRIPを使う範囲は異なるASになる
				- エリア0をバックボーンエリアと呼び、非バックボーンエリアは全てバックボーンエリアに接続されていなければいけない
					- バックボーンエリアの存在意義が不明
					- バックボーンエリアは分割できない
						- 直接接続出来ない場合は、OSPF仮想リンクという仕組みを使う
						- OSPF仮想リンクがどういう仕組みなのかは不明
		- L3SW([参考1](https://nttdocomo-ssw.com/nssw/dhkr/ouchinetpress/communication/article147/)、[参考2](https://e-words.jp/w/L3%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81.html)、[参考3](https://www.nuro.jp/article/l3suitchi-router/))
			- 結局よく分からない
			- L2SWとルーティング機能を備えた機器らしい
			- 普通のルータにはNATやNAPT機能があるが、L3SWにはない
				- LAN内のルーティングに使う
			- スイッチ要素はどこ？L2SWのMACアドレス学習とルーティング機能がどう組み合わさるのか分からない
		- デフォルトゲートウェイ、デフォルトルート、ホストルート
			- デフォルトゲートウェイ
				- PCが自身が属するネットワークの外に通信を行う時に、中継を依頼する機器のこと(基本ルータ)
				- DHCPで自動設定される
			- デフォルトルート
				- ルーティングテーブルに登録されていないIPアドレスに対する送信先
				- 0.0.0.0/0もしくはdefaultで登録する
			- ホストルート
				- 1つのIPアドレスだけを特別にルーティングする時はホストルートを設定する
				- IPアドレス/32で登録する(192.168.0.1/32など)
		- プライベートIPアドレスの範囲はRFCで決まっている([参考](https://itpfdoc.hitachi.co.jp/manuals/3021/3021324220/NNMS0200.HTM))
			- 10/8, 172.16/12, 192.168/16