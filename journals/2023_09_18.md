# 徳丸本
- ## 5章 代表的なセキュリティ機能
- ### 5.1 認証
- #### 5.1.1 ログイン機能
	- ログイン機能に対する攻撃
		- SQLインジェクションによるログイン機能のバイパス
		- SQLインジェクションによるパスワードの入手
			- ハッシュ化されていても、ブルートフォースで元のパスワードが特定され得る(後述)
		- ブルートフォース攻撃や辞書攻撃によるパスワード試行
		- ソーシャルエンジニアリングによるパスワード入手
			- ショルダーハックはソーシャルエンジニアリングの一種で、画面の覗き見でパスワードを入手すること
			- パスワード入力欄のマスク表示がショルダーハックの対策となる
		- フィッシングによるパスワード入手
			- 本物そっくりの偽サイトに重要情報を入力させる
	- セッションハイジャックでは再認証が必要な機能は悪用出来なかったが、パスワードが知られた場合は、悪用可能
- #### 5.1.2 パスワード認証を狙った攻撃への対策
	- ブルートフォース攻撃や辞書攻撃によるパスワード試行の対策として、アカウントロックが有効
		- アカウントロックが発生した場合はメールなどで対象利用者と管理者に通知する
		- アカウントロックの解除
			- 30分経過した場合、自動的に解除される
			- 管理者が何らかの方法で本人確認した後に解除する
		- 必要に応じて、攻撃が来ているIPアドレスからの通信を遮断する
	- パスワード認証に対する攻撃
		- 辞書攻撃
			- 使用頻度の高いパスワード候補から順に試す
		- ジョーアカウント探索
			- ジョーアカウントでログインを試みようとする
			- ジョーアカウントとは、ユーザIDと同じ文字列をパスワードに設定しているアカウント
		- リバースブルートフォース攻撃
			- パスワードを固定して、ユーザIDを変えながらログイン試行する
		- パスワードスプレー攻撃
			- 少数のパスワード候補をユーザIDを変えながら試していく
		- パスワードリスト攻撃
			- 別のサイトから漏洩したIDとパスワードの一覧を用いてログイン試行する
			- パスワードリストはブラックマーケットで流通していたりする
	- ブルートフォース攻撃と辞書攻撃は単純なアカウントロックで対処出来るが、それ以外の攻撃は対処出来ないので以下を利用する
		- 二段階認証
			- 追加の秘密情報を要求する
			- 秘密の質問の答え、メールやSMSで送られてくる6桁程度の数字、スマホアプリなどで生成される6桁程度の数字など
				- SMSを用いる場合は二要素認証と言っても良い([参考](https://www.ryobi.co.jp/security/feature/20200930-6))
			- 二段階認証を設定していても、フィッシングなどで不正アクセスされることはある([参考](https://sbapp.net/appnews/an/2dannkaininnsyoutoppa-148074))
		- 積極的なパスワードチェック
			- ありがちなパスワードやユーザIDと同じパスワードを拒否する
			- ジョーアカウント攻撃はこれで完全に防げる
			- リバースブルートフォース攻撃やパスワードスプレー攻撃は、ありがちなパスワードを試すものなので、そのようなパスワードを拒否すれば、成功率はかなり低減する
		- ログイン失敗率の監視
			- ログイン失敗率が高くなった場合は、原因調査の上、攻撃が来ているIPアドレスからの通信を遮断する
- #### 5.1.3 パスワードの保存方法
	- パスワードを暗号化して保存することは行わず、メッセージダイジェストで保存する
		- 復号化したい場面がないのと、復号化の鍵をどう保存するかが問題となるため
	- 任意の長さのデータを固定長のデータ(メッセージダイジェスト)に圧縮する関数をハッシュ関数と呼び、以下のセキュリティ上の要件を満たすハッシュ関数を暗号学的ハッシュ関数と呼ぶ
		- 原像計算困難性(一方向性)
		- 第二原像計算困難性(弱衝突耐性)
		- 衝突困難性(強衝突耐性)
		- それぞれの言葉の意味は、 ((64be7f6f-bd68-415a-8ab2-c5d827610760)) にある
	- パスワードをメッセージダイジェストで保存し、ログイン時は入力されたパスワードのメッセージダイジェストと保存されているメッセージダイジェストを比較する
	- ハッシュ値から元のパスワードを解析するための手法
		- オフラインブルートフォース攻撃
			- ハッシュ関数には高速性が求められるが、この高速性が災いして、現実的な時間内にブルートフォースが完了する場合がある
			- 本によると、NVIDIA GTX 1080 Tiを8個並べたマシンだと、英字・数字・記号からなる8桁のパスワードの総当たりは、MD5で約14分、SHA-1で約39分らしい
		- レインボーテーブル([参考](https://ja.wikipedia.org/wiki/%E3%83%AC%E3%82%A4%E3%83%B3%E3%83%9C%E3%83%BC%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB))
		- ダミーのユーザを多数登録し、同じハッシュ値を持つユーザを調べる
	- 対策
		- ソルト
			- ソルトをユーザ毎に異なるものにすることで、パスワードが同じでも異なるハッシュ値が生成される
			- ソルトはハッシュ値が保存されているテーブルと同じテーブルに保存されていることが多く、漏洩時に、ハッシュ値からパスワードが特定される場合がある
				- ソルトを使うことで、レインボーテーブルのような前計算の意味は無くなるが、ハッシュ値の計算時間はさほど変わらないため、ブルートフォースが完了する場合がある
			- ソルトに加えて、.envなどに保存した値を利用してハッシュ化をすることでより安全となる([参考](https://qiita.com/YutaManaka/items/93444c803cf3087af2b5))
				- .envなどに保存した値をペッパーと呼ぶ
				- 暗号学的ハッシュ関数の入力は、平文とソルトとペッパーを連結したものになる
		- ストレッチング
			- ハッシュ計算を繰り返し行うことをストレッチングと呼ぶ
		- ブルートフォース攻撃対策のために、あえて遅いハッシュ関数を用いる