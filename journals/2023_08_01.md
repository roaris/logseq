- # 暗号技術入門
- ## 第10章 証明書(続き)
- ### 階層的なPKI
- 認証局の公開鍵は、どのようにすれば正しいと判断することが出来るか？
	- 認証局の公開鍵に対して、別の認証局がデジタル署名を施す
	- 最上位の認証局をルートCAと呼び、ルートCAは自分自身の公開鍵に対してデジタル署名を行う(セルフ署名)
	- Bobの公開鍵に対して、認証局Aが証明書を発行しており、認証局Aの公開鍵に対して、認証局B(ルートCAとする)が証明書を発行している場合
		- Aliceは認証局Bの公開鍵を使って、認証局Aの公開鍵の証明書を検証し、認証局Aの公開鍵を入手する
		- 次に認証局Aの公開鍵を使って、Bobの公開鍵の証明書を検証し、Bobの公開鍵を入手する
- ### 証明書に対する攻撃
	- Bobが公開鍵を認証局に登録する際に、Malloryが公開鍵を自分のものにすり替える
		- これによって認証局は、Bobの情報とMalloryの公開鍵の組み合わせに対して、デジタル署名をすることになる
		- 対策
			- 認証局の公開鍵で暗号化してから認証局に送信する
			- 認証局がBobに対して公開鍵のMAC値を確認する
				- 認証局とBobで鍵を共有する必要がある
	- 認証局の秘密鍵を盗み出す
		- 認証局の秘密鍵が守られていることは、認証局の信頼性そのもの
		- 認証局の秘密鍵が盗まれたことは、Malloryが署名した証明書が発見された時に判明する
			- 認証局は作成した証明書のシリアル番号を記録していて、その証明書に認証局自身が署名したかが分かる
			- 秘密鍵が漏洩したら、CRLを使って漏洩したことを利用者に通知する必要がある
		- 認証局が気をつけるしかない
	- 攻撃者自身が認証局になる
		- 攻撃者自身が認証局になり、「正しい証明書」を発行する
		- 利用者が注意するしかない
	- CRLの隙を突く攻撃
		- CRLが届くまでの時間差を利用
			- MalloryがBobの秘密鍵を盗んで、これを使ったデジタル署名付きのメッセージをAliceに送信する
			- Bobが秘密鍵を盗まれたことに気づいて、公開鍵が無効になったことを認証局に伝え、認証局はBobの公開鍵を無効にするCRLを作成して配布する
			- これが間に合わず、AliceはMalloryからのデジタル署名を検証して成功したため、メッセージに従ってしまう(お金を口座に振り込むなど)
			- 対策
				- 秘密鍵が漏洩したら可能な限り早く認証局に公開鍵を無効にしてもらう
					- 自分のデジタル署名を勝手に作られる以外にも、通信を復号化されてしまう危険がある
				- 認証局は素早くCRLを発行する
				- 送信者はCRLをきちんと更新する & 公開鍵を利用する前には、公開鍵が無効になっていないかを確認する
					- 既に無効になった公開鍵で署名の検証をする以外にも、既に無効になった公開鍵で暗号化をしてしまう(暗号文は攻撃者に復号化されてしまう)危険がある
		- CRLを使った否認
			- デジタル署名付きのメッセージを送信した後で、秘密鍵が漏洩したから公開鍵を無効にしてくれと認証局に偽る
			- 秘密鍵が漏洩したから他の人が送ったメッセージなんだろうと、メッセージを送信したことを否認する
			- 技術的にこれを検出する事は出来ず、通常の犯罪の捜査が必要
- ### IDベース暗号
	- ID(メールアドレスなどの個人を特定出来る情報)から公開鍵を生成する
	- 公開鍵が正しいことを示す証明書は不要(IDを絶対的に信用するという前提)
	- 認証局は不要になるが、秘密鍵を生成する機関が必要
		- IDは誰でも分かるので、誰もがIDから秘密鍵を生成出来たら困る
		- 正しい受信者に秘密鍵を安全に配送する必要がある
		- 全ての暗号を復号化出来る権限を持つため、非常に注意して運用する必要がある