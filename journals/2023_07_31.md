- # 暗号技術入門
- ## 第10章 証明書
- ### 証明書とは
	- 公開鍵証明書(単に証明書とも)
		- 名前、所属、メールアドレスなどの個人情報と、その人の公開鍵が記載されている
		- 認証局が「この公開鍵は確かにこの人のものである」と認めたことが分かる
		- 運転免許証みたいなもの
	- 認証局を使ったAliceからBobへの暗号文の送信
		- Bobが鍵ペアを作成する(認証局に作ってもらう場合もある)
		- Bobは公開鍵を認証局に送る
		- 認証局は受け取った公開鍵が本当にBobのものであるかを確認する
			- 一番厳しいものだと、対面認証 + 身分証明書による本人確認
		- 認証局はBobの公開鍵に自局の秘密鍵でデジタル署名を行い証明書を作成する
			- 証明書にはBobの公開鍵と認証局によるデジタル署名が含まれる
		- AliceはBobの証明書を入手する
			- コンピュータ内に保存しておけば良い
		- Aliceは認証局の公開鍵を使ってデジタル署名を検証し、Bobの公開鍵が正しいことを検証する
		- AliceはBobの公開鍵を使って、メッセージを暗号化し送信する
			- ハイブリッド暗号システムの場合は、セッション鍵を暗号化して送信する
	- 証明書には標準規格がある
		- 利用者が検証するため、証明書の形式がばらばらだと困る
		- 最も広く使われているのは、X.509という規格
- ### 公開鍵基盤(PKI)
	- 公開鍵を効果的に運用するために定められた規格や仕様
	- PKIの構成要素
		- 利用者: PKIを利用する人
			- 公開鍵を登録する人
				- 必要が生じたら(秘密鍵が漏洩するなど)、認証局に登録した公開鍵を無効にしてもらう
			- 公開鍵で暗号化 or デジタル署名の検証をする人
		- 認証局: 証明書を発行する人
			- 公開鍵の登録と本人の認証を登録局に任せる場合もある
				- 認証局は証明書の発行だけに注力でき、認証局の負担が減るが、やり取りが複雑になり、攻撃を受けるポイントが増える
		- リポジトリ(証明書ディレクトリ): 証明書を保管しているデータベース
			- 上に書いた流れで、AliceがBobの証明書を入手する際はリポジトリを利用する
	- 認証局の仕事
		- 鍵ペアの作成
			- 認証局が鍵ペアを作る場合がある
			- その場合は秘密鍵を利用者に送る必要がある(この方法はRFC7292で定められている)
		- 証明書の発行
		- 証明書の破棄とCRLの作成
			- 証明書を破棄(revoke)するのは秘密鍵が漏洩した時だけではない
				- 利用者が退職により秘密鍵を使う権限を失った場合や、名前が変わって証明書の記載内容と合わなくなった場合も証明書を破棄する
			- リポジトリから削除しても破棄したことにはならない
				- 利用者のコンピュータに保存されているため
			- 証明書を破棄する場合、証明書破棄リスト(CRL: Certificate Revocation List)を作成する
				- 破棄された証明書のシリアル番号の一覧に対して、認証局がデジタル署名をつけたもの
					- シリアル番号とは、その認証局が発行した証明書につけられた通し番号
				- PKIの利用者は、認証局から最新のCRLを入手して、暗号化 or デジタル署名の検証に使おうとしている公開鍵の証明書が破棄されていないかを調べる必要がある
					- 有効期限内だからといって有効な証明書だとは言えない
					- ユーザの仕事というよりも証明書を扱うソフトウェアの仕事