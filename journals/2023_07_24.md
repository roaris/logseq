# 暗号技術入門
- ## 第6章 ハイブリッド暗号システム
- 公開鍵暗号には以下の問題がある
	- 入手した公開鍵が、本当に正しい公開鍵であるか判断できない(中間者攻撃に繋がる)
	- 共通鍵暗号に比べて、処理速度が何百倍も遅い
- ハイブリッド暗号は2個目の問題を解決するもの
	- メッセージは対称暗号で暗号化する
		- 暗号化に使うセッション鍵は、擬似乱数生成器で生成する
	- セッション鍵は、公開鍵暗号で暗号化する
		- メッセージの長さに比べて、対称暗号の鍵は短いのが普通(せいぜい十数バイト)なので、公開鍵暗号の遅さは気にならない
	- 対称暗号で暗号化されたメッセージと公開鍵暗号で暗号化されたセッション鍵を組み合わせたものが、ハイブリッド暗号にとっての暗号文
	- セッション鍵は使い回さない
		- 使い回さなければ、もしセッション鍵が漏洩したとしても、解読されるのは1回分の通信だけで済む
- ## 第7章 一方向ハッシュ関数
	- 正真性(integrity) : 本物であること
	- 一方向ハッシュ関数はメッセージからハッシュ値を計算し、このハッシュ値は正真性のチェックに使うことが出来る
		- ハッシュ値の長さは、メッセージの長さとは無関係
			- SHA-256の場合、ハッシュ値は常に256ビット
- ### 一方向ハッシュ関数が満たすべき性質
	- 任意長のメッセージを入力可能 & ハッシュ値が固定長
		- メッセージが長ければ長いほど、ハッシュ値も長くなってしまったら困る
	- ハッシュ値を高速に計算出来る
	- メッセージが異なれば、非常に高い確率でハッシュ値も異なる必要がある
		- 2つの異なるメッセージが同じハッシュ値を持つことを衝突といい、衝突を見つけることが事実上不可能でなければならない
		- 弱衝突耐性 : 入力m1が与えられた時、hash(m1)=hash(m2)となるような別の入力m2を求めることが困難で無くてはならない
		- 強衝突耐性 : hash(m1)=hash(m2)となる2つの異なるメッセージm1とm2を探し出すことが困難で無くてはならない
		- 弱衝突耐性が破られたとしたら、強衝突耐性は破られている
		- [参考](https://qiita.com/Shellyhackinglab/items/522e9815373e4b2649ff)
	- 一方向性を持つ
		- ハッシュ値からメッセージを逆算することは出来ない
		- 暗号化を行っているわけではない(復号化して元のメッセージを得ることは出来ないため)
- ### 用語
	- 正真性は、完全性や保全性とも呼ばれる
	- 一方向ハッシュ関数は、メッセージダイジェスト関数、メッセージ要約関数、暗号学的ハッシュ関数とも呼ばれる
	- 一方向ハッシュ関数の入力となるメッセージは、プレ・イメージとも呼ばれる
	- ハッシュ値は、メッセージダイジェストやフィンガープリントとも呼ばれる
- ### 応用例
	- ソフトウェアの改竄検出
	- パスワードの暗号化
		- パスワードとソルトを混ぜた結果のハッシュ値を求めることで、パスワードに対する辞書攻撃を防ぐ
	- メッセージ認証コード
	- デジタル署名
	- 擬似乱数生成器
	- ワンタイムパスワード
- ### 一方向ハッシュ関数の具体例
	- MD4, MD5
		- MDはMessage Digestの略
		- どちらも128ビットのハッシュ値を生成する
		- 強衝突耐性が既に破られている
	- SHA-1, SHA-256, SHA-384, SHA-512
		- SHAはSecure Hash Algorithmの略
		- それぞれ160ビット、256ビット、384ビット、512ビットのハッシュ値を生成する
		- SHA-256, SHA-384, SHA-512はまとめてSHA-2と呼ぶ
		- SHA-1、SHA-256は2^64ビット未満、SHA-384、SHA-512は2^128ビット未満のメッセージしか入力出来ない
		- SHA-1は強衝突耐性が破られているが、SHA-2はまだ破られていない
	- RIPEMD-160
		- 160ビットのハッシュ値を生成
	- SHA-3
		- コンペ方式により、KECCAK(ケチャック)がSHA-3として選定された
- ### 一方向ハッシュ関数への攻撃
	- ブルートフォース
		- 冗長性を利用して、オリジナルのメッセージと同じハッシュ値を持つメッセージを見つけ出し、オリジナルのメッセージを置き換える
			- 「アリスの支払い金額は百万円とする。」 → 「アリスの支払い金額は一億円とする。」
		- 冗長性というのは、メッセージ末尾に空白文字を1個追加、2個追加、3個追加、...していってもメッセージの意味は変わらないこと
		- 弱衝突耐性を破ろうとする攻撃
	- 誕生日攻撃
		- 同じハッシュ値を持つメッセージを用意し、後から置き換える
		- 誕生日のパラドックス
			- N人のクラスで、少なくとも2人の誕生日が一致する確率が1/2以上になるために、Nはいくつ以上でないといけない？
			- 1 - (365 x 364 x ... x (365-N+1)) / (365^N) ≥ 1/2 を満たす最小のNは23 → 想像以上に小さいというパラドックス
		- 誕生日のパラドックスを一般化すると、等確率でY通りの取りうる値があるものをN個用意した時に、少なくとも2個の値が一致する確率が1/2以上となるために、Nはいくつ以上でないといけない？という問題になる
			- Yが非常に大きい時は、近似的な計算により、N≒√Yとなる
			- ハッシュ値が512ビットなら、2^256通りのメッセージを作成すれば、1/2以上の確率で、ハッシュ値が一致するメッセージが存在する(ハッシュ値が等確率で生成されるという仮定を置いている)
		- 強衝突耐性を破ろうとする攻撃
- ### 一方向ハッシュ関数でも解決出来ない問題
	- 改竄は検出出来るが、なりすましは検出出来ない
		- なりすましが送信したメッセージの正真性を示しても意味がない
- # Misc
	- [ハッシュ化のソルト(salt)とペッパー(pepper)についてまとめた - Qiita](https://qiita.com/YutaManaka/items/93444c803cf3087af2b5)
		- ソルトをDBに保存していると、漏洩時にハッシュ値からパスワードを特定できてしまう
		- 環境変数から読み取るソルトのことをペッパーと呼ぶらしい
			- 普通、環境変数では？という感じがするが...