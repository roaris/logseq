# 暗号技術入門
- ## 第12章 乱数
- ### 乱数を使用する場面
	- 対称暗号やメッセージ認証コードにおける鍵の生成
	- 公開鍵暗号やデジタル署名における鍵ペアの生成
	- ブロック暗号の各モードにおける初期化ベクトルの生成
	- メッセージ認証コードにおける再生攻撃を防止するためのnonceや、ブロック暗号のCTRモードにおけるnonceの生成
	- ソルトの生成
- ### 乱数の性質
	- 無作為性、予測不可能性、再現不可能性の3つに分類され、無作為性 < 予測不可能性 < 再現不可能性の順番で厳しい
		- 無作為性を持つからといって、予測不可能性を持つとは限らない
		- 予測不可能性を持つ擬似乱数は無作為性を持ち、再現不可能性を持つ擬似乱数は無作為性および予測不可能性を持つ
		- 暗号技術で使う乱数は少なくとも予測不可能性を持つ必要がある
		- 無作為性までを満たす乱数を弱い擬似乱数、予測不可能性までを満たす乱数を強い擬似乱数、再現不可能性を満たす乱数を真の乱数と呼ぶ
	- 無作為性
		- 統計的な偏りがなく、でたらめな数列になっているという性質
		- 0~9までの範囲の整数を生成する場合、0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 1, 2, ... となっていたり、0が1つも登場しなかったり、全体の半分が6になっていたりしたら無作為性を満たさない
		- 無作為性を満たすかは「乱数の検定」によって調べる
		- ゲームやシミュレーションで使う乱数は無作為性を持っていれば十分だが、暗号技術では不十分
	- 予測不可能性
		- シード値は秘密だが、擬似乱数生成器のアルゴリズムと、過去の擬似乱数列が攻撃者に知られている状態で、次の擬似乱数を予測されないという性質
	- 再現不可能性
		- 同じ数列を再現できないという性質
		- ソフトウェアだけでは再現不可能な乱数列を作ることは出来ない
			- ソフトウェアが有限の内部状態しか持たないのと、ソフトウェアは同じ内部状態からは同じ数を生成するため、いつか繰り返しに陥る
		- 再現不可能な物理現象(周りの温度や音の変化)から情報を得る必要がある
			- IntelのCPUには熱雑音という自然現象を元に、再現不可能性を持つ乱数を得る命令がある
- ### 擬似乱数生成器
	- 擬似乱数生成器は内部状態を持つ
		- シード値によって内部状態が初期化される
		- シード値は自分だけの秘密にする(現在時刻のような予測可能な値にしてはいけない)
	- 擬似乱数を1個欲しいという要求が来た時
		- 内部状態を元に計算を行い、計算結果を擬似乱数として返す
		- 次の要求に備えて、内部状態を変化させる
	- 内部状態から擬似乱数を計算する方法と内部状態を変化させる方法を合わせたのが擬似乱数生成器のアルゴリズムになる
- ### 具体的な擬似乱数生成器
	- でたらめな方法
		- プログラマすら詳細を理解出来ないような複雑なアルゴリズムを使う
		- 多くの場合は周期が短くなってしまい予測不可能性を持たなくなってしまうのと、プログラマすら詳細を理解出来ない方法だと、予測不可能性を持つのかの評価が難しくなるため、間違った方法
	- 線形合同法
	  id:: 64cbb297-e215-422f-927e-d08b9c058410
		- R0, R1, R2, ... という擬似乱数の列を生成するとして、R0 = (A x シード値 + C) % M、R1 = (A x R0 + C) % M、R2 = (A x R1 + C) % M、... としていく方法
			- A, C, Mは定数で、AとCはMより小さい数
		- 内部状態は最後に生成した擬似乱数の値
		- 周期は最大でMだが、AとCの選び方によっては極端に周期が短くなってしまう
		- Mを大きくし、AとCを注意深く選択すれば、無作為性を持つが、予測不可能性は持たないため、暗号技術に使ってはいけない
			- 実は、攻撃者はA, C, Mを知らなくても、線形合同法で生成された数列から、A, C, Mを逆算することが出来る(やり方は調べてない)
		- Cのrand関数とかJavaのjava.util.Randomクラスでは線形合同法が用いられている
	- 一方向ハッシュ関数を使う方法
		- 内部状態としてカウンタを持ち、カウンタはシード値で初期化する
		- 一方向ハッシュ関数を使って、カウンタのハッシュ値を計算し、これを擬似乱数とする
		- 次の擬似乱数の生成のために、カウンタを1増加させる
		- 一方向ハッシュ関数の一方向性により予測不可能性を持つ
	- 暗号を使う方法
		- 内部状態としてカウンタを持つ
		- カウンタの初期値と暗号化のための鍵がシード値になる
			- 暗号化の方法はAESやRSAなど
		- カウンタを暗号化したものを擬似乱数とする
		- 次の擬似乱数の生成のために、カウンタを1増加させる
		- 暗号の機密性により予測不可能性を持つ
		- 実用性としてANSI X9.17などがある
- ## 第13章 PGP
- ### PGPとは
	- PGP(Pretty Good Privacy)とは1990年頃に開発された暗号ソフトウェア
	- 対称暗号、公開鍵暗号、デジタル署名、一方向ハッシュ関数、証明書、データの圧縮/伸張、テキストデータとバイナリデータの相互変換、大きなファイルの分割/結合、鍵管理などの機能を備えている
	- 生成した鍵ペアや、入手した公開鍵を管理する機能を持つ
		- 鍵を管理するファイルを鍵リングや鍵束と呼ぶ
- ### 暗号化
	- 擬似乱数生成器と使ってセッション鍵を生成する
	- メッセージを圧縮し、セッション鍵で暗号化する
		- 暗号化をしてから圧縮する方法だと、ビット列の冗長性が失われているため、ほとんど圧縮出来ない
	- セッション鍵を受信者の公開鍵で暗号化する
	- 暗号化したセッション鍵と暗号化したメッセージを結合し、テキストデータに変換して送信する
- ### 復号化
	- 秘密鍵の復号化
		- 受信者の秘密鍵は盗難に備えて暗号化されて鍵リングに保存されている
		- 受信者は頭の中に記憶しているパスフレーズを入力し、パスフレーズとソルトを結合した値のハッシュ値を取り、これを使って秘密鍵を復号化する
	- 受信データをバイナリデータに変換し、暗号化されたセッション鍵と暗号化されたメッセージに分解する
	- 暗号化されたセッション鍵を受信者の秘密鍵で復号し、これを使って暗号化されたメッセージを復号化する
	- 圧縮されたメッセージを伸張する